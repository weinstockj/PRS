<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · PRSFNN.jl</title><meta name="title" content="Home · PRSFNN.jl"/><meta property="og:title" content="Home · PRSFNN.jl"/><meta property="twitter:title" content="Home · PRSFNN.jl"/><meta name="description" content="Documentation for PRSFNN.jl."/><meta property="og:description" content="Documentation for PRSFNN.jl."/><meta property="twitter:description" content="Documentation for PRSFNN.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>PRSFNN.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#PRSFNN"><span>PRSFNN</span></a></li><li><a class="tocitem" href="#Features"><span>Features</span></a></li><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Getting-Started"><span>Getting Started</span></a></li><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li><a class="tocitem" href="#Documentation"><span>Documentation</span></a></li><li><a class="tocitem" href="#Running-the-Tests"><span>Running the Tests</span></a></li><li><a class="tocitem" href="#Contact"><span>Contact</span></a></li><li><a class="tocitem" href="#Functions"><span>Functions</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/weinstockj/PRS" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/weinstockj/PRS/blob/master/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="PRSFNN"><a class="docs-heading-anchor" href="#PRSFNN">PRSFNN</a><a id="PRSFNN-1"></a><a class="docs-heading-anchor-permalink" href="#PRSFNN" title="Permalink"></a></h2><p><a href="PRSFNN_logo_small.svg">logo</a></p><p>PRSFNN (Polygenic Risk Score with Functional Neural Networks) is a Julia module for calculating polygenic risk scores by integrating GWAS summary statistics with functional annotations using neural networks.</p><h2 id="Features"><a class="docs-heading-anchor" href="#Features">Features</a><a id="Features-1"></a><a class="docs-heading-anchor-permalink" href="#Features" title="Permalink"></a></h2><ul><li>Integration of GWAS summary statistics with functional annotations</li><li>Linkage disequilibrium (LD) calculation and correction</li><li>Coordinate Ascent Variational Inference (CAVI) for posterior effect size estimation</li><li>Neural network models to learn the relationship between functional annotations and genetic effect sizes</li></ul><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><pre><code class="language-julia hljs"># From the Julia REPL
using Pkg
Pkg.add(url=&quot;https://github.com/weinstockj/PRS.jl&quot;)</code></pre><h2 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h2><p>Steps to load this module from the root directory:</p><ol><li>Run <code>julia --color=yes --project=.</code> (requires Julia 1.9.0 or later)</li><li>Run <code>using Revise</code> # helpful while developing</li><li>Run <code>using PRSFNN</code></li></ol><p>Now the functions have been loaded.  To call an internal function, use <code>PRSFNN.function_name</code> </p><p>To run Julia in debugger mode: <code>JULIA_DEBUG=PRSFNN julia --color=yes --project=.</code></p><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><h3 id="Basic-Example"><a class="docs-heading-anchor" href="#Basic-Example">Basic Example</a><a id="Basic-Example-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Example" title="Permalink"></a></h3><pre><code class="language-julia hljs">using PRSFNN

# Run PRSFNN on a genomic region
result = main(
    output_prefix = &quot;chr3_block1&quot;,
    annot_data_path = &quot;path/to/annotations.parquet&quot;, 
    gwas_data_path = &quot;path/to/gwas_stats.tsv&quot;,
    ld_panel_path = &quot;path/to/ld_panel&quot;
)</code></pre><h3 id="Simulating-GWAS-Data"><a class="docs-heading-anchor" href="#Simulating-GWAS-Data">Simulating GWAS Data</a><a id="Simulating-GWAS-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Simulating-GWAS-Data" title="Permalink"></a></h3><p>For testing and development, you can simulate GWAS summary statistic data:</p><pre><code class="language-julia hljs"># Generate simulated data
raw = simulate_raw(;N = 10_000, P = 1_000, K = 100, h2 = 0.10)
# Extract sufficient statistics needed for PRS
summary_stats = estimate_sufficient_statistics(raw.X, raw.Y)

# Visualize the true effect size distribution
using Plots
histogram(raw.β, title=&quot;True β Distribution&quot;)</code></pre><h3 id="Training-a-PRS-Model"><a class="docs-heading-anchor" href="#Training-a-PRS-Model">Training a PRS Model</a><a id="Training-a-PRS-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Training-a-PRS-Model" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Train the PRS model
XtX = construct_XtX(ss.R, size(ss.X, 2), size(ss.X, 1))
D = construct_D(XtX)
Xty = construct_Xty(ss.coef, D)

σ2, R2, yty = infer_σ2(
    summary_stats.BETA, 
    summary_stats.SE, 
    XtX, 
    Xty, 
    size(ss.X, 1), 
    size(ss.X, 2); 
    estimate = true, 
    λ = 0.50 * size(ss.X, 1)
)

K = size(raw.G, 2)

layer_1 = Dense(K =&gt; H, Flux.softplus; init = Flux.glorot_normal(gain = 0.005))
layer_output = Dense(H =&gt; 2)
layer_output.bias .= [StatsFuns.log(0.001), StatsFuns.logit(0.1)]
model = Chain(layer_1, layer_output)
initial_lr = 0.00005
#    initial_lr = 0.0001
optim_type = AdamW(0.001)
opt = Flux.setup(optim_type, model)

PRS = train_until_convergence(
    summary_stats.BETA_std,
    summary_stats.SE,
    summary_stats.R, 
    XtX,
    Xty,
    raw.G,
    model = model,
    opt = opt,
    σ2 = σ2,
    R2 = R2,
    yty = yty,
    N = size(summary_stats.X, 1),
    train_nn = false,
    max_iter = 5
)</code></pre><h2 id="Documentation"><a class="docs-heading-anchor" href="#Documentation">Documentation</a><a id="Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation" title="Permalink"></a></h2><p>For more detailed documentation, visit the <a href="https://weinstockj.github.io/PRS/dev">official documentation site</a>.</p><h2 id="Running-the-Tests"><a class="docs-heading-anchor" href="#Running-the-Tests">Running the Tests</a><a id="Running-the-Tests-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-Tests" title="Permalink"></a></h2><p>Run unit tests with:</p><pre><code class="language-julia hljs">julia --project=. test/runtests.jl</code></pre><p>or interactively with:</p><pre><code class="language-julia hljs">includet(&quot;test/runtests.jl&quot;)</code></pre><h2 id="Contact"><a class="docs-heading-anchor" href="#Contact">Contact</a><a id="Contact-1"></a><a class="docs-heading-anchor-permalink" href="#Contact" title="Permalink"></a></h2><p>Please address correspondence to:</p><ul><li>Josh Weinstock &lt;josh.weinstock@emory.edu&gt;</li><li>April Kim &lt;aprilkim@jhu.edu&gt;</li><li>Alexis Battle &lt;ajbattle@jhu.edu&gt;</li></ul><h2 id="Functions"><a class="docs-heading-anchor" href="#Functions">Functions</a><a id="Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.main" href="#PRSFNN.main"><code>PRSFNN.main</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>PRSFNN</p><p>This function defines the command line interface for the PRSFNN package.</p><p><strong>Arguments</strong></p><ul><li><code>output_prefix</code>: A prefix for the output files</li><li><code>annot_data_path</code>: A path to the directory containing the annotations</li><li><code>ld_panel_path</code>: A path to the directory containing the LD reference panel </li><li><code>gwas_data_path</code>: A path to the GWAS summary statistics file </li><li><code>model_file</code>: A path to the file containing the trained model </li><li><code>betas_output_file</code>: A path to the file where the PRS betas will be saved </li><li><code>interpretation_output_file</code>: A path to the file where the interpretation of the model will be saved</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/main.jl#L1-L16">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.rss" href="#PRSFNN.rss"><code>PRSFNN.rss</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rss(β, coef, Σ, SRSinv, to)</code></pre><p>Calculate the summary statistic RSS likelihood.</p><p><strong>Arguments</strong></p><ul><li><code>β::Vector</code>: Vector of effect sizes.</li><li><code>coef::Vector</code>: Observed coefficients.</li><li><code>Σ::AbstractPDMat</code>: Positive definite covariance matrix.</li><li><code>SRSinv::Matrix</code>: Precomputed matrix for efficiency.</li><li><code>to</code>: Timer object for benchmarking.</li></ul><p><strong>Returns</strong></p><ul><li><code>Float64</code>: Log likelihood value.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">rss(
    [0.0011, 0.0052, 0.0013],
    [-0.019, 0.013, -0.0199],
    PDMat(Σ),
    SRSinv,
    TimerOutput()
)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/loss.jl#L70-L95">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.elbo" href="#PRSFNN.elbo"><code>PRSFNN.elbo</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">elbo(z, q_μ, log_q_var, coef, SE, R, σ2_β, p_causal, σ2, [spike_σ2], to)</code></pre><p>Compute the Evidence Lower Bound (ELBO) for variational inference.</p><p><strong>Arguments</strong></p><ul><li><code>z::Vector</code>: Random vector from standard normal distribution.</li><li><code>q_μ::Vector</code>: Mean vector of the variational distribution.</li><li><code>log_q_var::Vector</code>: Log variance vector of the variational distribution.</li><li><code>coef::Vector</code>: Observed coefficients.</li><li><code>SE::Vector</code> or <code>Σ::AbstractPDMat</code>: Standard errors or covariance matrix.</li><li><code>R::AbstractArray</code> or <code>SRSinv::Matrix</code>: Correlation matrix or precomputed matrix.</li><li><code>σ2_β::Vector</code>: Vector of prior variances for effect sizes.</li><li><code>p_causal::Vector</code>: Vector of prior probabilities that each SNP is causal.</li><li><code>σ2::Real</code>: Global variance parameter.</li><li><code>spike_σ2::Real</code>: Optional variance parameter for the spike component.</li><li><code>to</code>: Timer object for benchmarking.</li></ul><p><strong>Returns</strong></p><ul><li><code>Float64</code>: Computed ELBO value.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">elbo(
    rand(Normal(0, 1), 3),
    [0.01, -0.003, 0.0018],
    [-9.234, -9.24, -9.24],
    [0.023, -0.0009, -0.0018],
    [0.0094, 0.00988, 0.0102],
    [1.0 0.03 0.017; 0.031 1.0 -0.03; 0.017 -0.02 1.0],
    [0.01, 0.01, 0.01],
    [0.10, 0.10, 0.10],
    0.01,
    TimerOutput()
)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/loss.jl#L139-L175">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.joint_log_prob" href="#PRSFNN.joint_log_prob"><code>PRSFNN.joint_log_prob</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">joint_log_prob(β, coef, SE, R, σ2_β, p_causal, σ2, [to])</code></pre><p>Compute the joint log probability of the model combining likelihood and prior.</p><p><strong>Arguments</strong></p><ul><li><code>β::Vector</code>: Vector of effect sizes.</li><li><code>coef::Vector</code>: Observed coefficients.</li><li><code>SE::Vector</code> or <code>Σ::AbstractPDMat</code>: Standard errors or covariance matrix.</li><li><code>R::Matrix</code> or <code>SRSinv::Matrix</code>: Correlation matrix or precomputed matrix.</li><li><code>σ2_β::Vector</code>: Vector of prior variances for effect sizes.</li><li><code>p_causal::Vector</code>: Vector of prior probabilities that each SNP is causal.</li><li><code>σ2::Real</code>: Global variance parameter.</li><li><code>spike_σ2::Real</code>: Optional variance parameter for the spike component.</li><li><code>to</code>: Timer object for benchmarking.</li></ul><p><strong>Returns</strong></p><ul><li><code>Float64</code>: Joint log probability.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">joint_log_prob(
    [0.0011, 0.0052, 0.0013],
    [-0.019, 0.013, -0.0199],
    [0.0098, 0.0098, 0.0102],
    [1.0 0.03 0.017; 0.031 1.0 -0.03; 0.017 -0.02 1.0],
    [0.01, 0.01, 0.01],
    [0.10, 0.10, 0.10],
    0.01,
    TimerOutput()
)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/loss.jl#L102-L134">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.train_until_convergence" href="#PRSFNN.train_until_convergence"><code>PRSFNN.train_until_convergence</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">`train_until_convergence(coef, SE, R, D, G; max_iter = 20, threshold = 0.1, N = 10_000)`

# Arguments
- `coef::Vector`: A length P vector of effect sizes
- `SE::Vector`: A length P vector of standard errors
- `R::AbstractArray`: A P x P correlation matrix
- `D::Vector`: A length P vector of the sum of squared genotypes
- `G::AbstractArray`: A P x K matrix of annotations</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/train.jl#L240-L250">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.fit_heritability_nn" href="#PRSFNN.fit_heritability_nn"><code>PRSFNN.fit_heritability_nn</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>fit<em>heritability</em>nn(model, q<em>μ, q</em>μ<em>sq, q</em>alpha, G)</p><p>Fit the heritability neural network model.</p><p><strong>Arguments</strong></p><ul><li><code>model::Chain</code>: A neural network model</li><li><code>q_μ::Vector</code>: A length P vector of posterior means</li><li><code>q_μ_sq::Vector</code>: A length P vector of posterior variances</li><li><code>q_α::Vector</code>: A length P vector of posterior probabilities of being causal</li><li><code>G::AbstractArray</code>: A P x K matrix of annotations</li></ul><pre><code class="language-julia-repl hljs">    model = Chain(
        Dense(20 =&gt; 5, relu; init = Flux.glorot_normal(gain = 0.0005)),
        Dense(5 =&gt; 2)
    )

    G = rand(Normal(0, 1), 100, 20)
    q_μ_sq = (G * rand(Normal(0, 0.10), 20)) .^ 2
    q_α = 1.0 ./ (1.0 .+ exp.(-1.0 .* (-2.0 .+ q_μ_sq)))
    trained_model = PRSFNN.fit_heritability_nn(
        model, 
        q_μ_sq, 
        q_α, 
        G
    )
    yhat = transpose(trained_model(transpose(G)))
    yhat[:, 1] .= exp.(yhat[:, 1])
    yhat[:, 2] .= 1.0 ./ (1.0 .+ exp.(-yhat[:, 2]))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/nn.jl#L167-L198">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.log_prior" href="#PRSFNN.log_prior"><code>PRSFNN.log_prior</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">log_prior(β, σ2_β, p_causal, σ2, spike_σ2, to)</code></pre><p>Calculate the log density of β based on a spike and slab prior.</p><p><strong>Arguments</strong></p><ul><li><code>β::Vector</code>: Vector of effect sizes.</li><li><code>σ2_β::Vector</code>: Vector of prior variances for effect sizes.</li><li><code>p_causal::Vector</code>: Vector of prior probabilities that each SNP is causal.</li><li><code>σ2::Real</code>: Global variance parameter.</li><li><code>spike_σ2::Real</code>: Variance parameter for the spike component.</li><li><code>to</code>: Timer object for benchmarking.</li></ul><p><strong>Returns</strong></p><ul><li><code>Float64</code>: Log prior density.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/loss.jl#L6-L21">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.estimate_sufficient_statistics" href="#PRSFNN.estimate_sufficient_statistics"><code>PRSFNN.estimate_sufficient_statistics</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">estimate_sufficient_statistics(X, Y)</code></pre><p>Estimate the sufficient statistics for genetic association analysis from genotypes and phenotypes.</p><p><strong>Arguments</strong></p><ul><li><code>X::AbstractArray</code>: Genotype matrix (N×P) where N is the number of samples and P is the number of SNPs.</li><li><code>Y::Vector</code>: Phenotype vector of length N.</li></ul><p><strong>Returns</strong></p><p>A named tuple containing:</p><ul><li><code>coef::Vector</code>: Regression coefficients for each SNP.</li><li><code>SE::Vector</code>: Standard errors of the regression coefficients.</li><li><code>Z::Vector</code>: Z-scores (coef/SE) for each SNP.</li><li><code>R::Matrix</code>: Correlation matrix of the genotypes (LD matrix).</li><li><code>D::Vector</code>: Sum of squares for each SNP (diagonal of X&#39;X).</li></ul><p><strong>Description</strong></p><p>This function computes the basic summary statistics needed for genetic association analysis, including marginal effect sizes, standard errors, test statistics, and the correlation  structure between variants.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">X = randn(1000, 100)  # 1000 samples, 100 SNPs
Y = randn(1000)       # Phenotypes
stats = estimate_sufficient_statistics(X, Y)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/simulate.jl#L118-L146">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.compute_LD" href="#PRSFNN.compute_LD"><code>PRSFNN.compute_LD</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_LD(LD_reference::String)</code></pre><p>Compute linkage disequilibrium (LD) correlation matrix from a reference genotype file.</p><p><strong>Arguments</strong></p><ul><li><code>LD_reference::String</code>: Path to the BED format genotype file</li></ul><p><strong>Returns</strong></p><ul><li><code>R::Matrix{Float64}</code>: LD correlation matrix for polymorphic variants</li><li><code>sds::Vector{Float64}</code>: Standard deviations of genotypes for each variant</li><li><code>allele_freq::Vector{Float64}</code>: Allele frequencies (mean/2) for each variant</li><li><code>good_variants::Vector{Int}</code>: Indices of polymorphic variants that passed QC filters</li></ul><p><strong>Details</strong></p><p>This function reads genotype data from a BED file, converts it to floating point representation, filters out monomorphic variants and those with very low variance, and computes the correlation matrix between the remaining variants. Variants are filtered based on mean frequency and standard deviation thresholds.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/LD.jl#L1-L20">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.fit_genome_wide_nn" href="#PRSFNN.fit_genome_wide_nn"><code>PRSFNN.fit_genome_wide_nn</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>fit<em>genome</em>wide<em>nn(betas, annotation</em>files<em>dir, model</em>file; n<em>epochs, H, n</em>test, learning<em>rate</em>decay, patience)</p><p>Train a neural network model to predict variant effects using genome-wide annotation data.</p><p><strong>Arguments</strong></p><ul><li><code>betas</code>: Path to file containing PRS beta values from previous analysis</li><li><code>annotation_files_dir</code>: Directory containing annotation parquet files</li><li><code>model_file</code>: Path where the trained model will be saved</li><li><code>n_epochs</code>: Number of training epochs (default: 1306)</li><li><code>H</code>: Number of hidden units in the neural network (default: 3)</li><li><code>n_test</code>: Number of test samples to use for evaluation (default: 30)</li><li><code>learning_rate_decay</code>: Learning rate decay factor (default: 0.98)</li><li><code>patience</code>: Number of epochs to wait before reducing learning rate (default: 30)</li></ul><p><strong>Returns</strong></p><ul><li><code>model</code>: The trained neural network model</li><li><code>opt</code>: The optimizer state</li><li><code>global_σ2</code>: Global residual variance estimate</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/nn.jl#L1-L20">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.train_cavi" href="#PRSFNN.train_cavi"><code>PRSFNN.train_cavi</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">train_cavi(p_causal, σ2_β, coef, SE, R, XtX, Xty, to; P = 1_000, n_elbo = 10, max_iter = 5, N = 10_000, yty = 10_000, spike_σ2 = 1e-6, update_σ2 = true, σ2 = 1.0)</code></pre><p>Performs Coordinate Ascent Variational Inference (CAVI) for a spike-and-slab model to estimate genetic variant effect sizes and posterior inclusion probabilities.</p><p><strong>Arguments</strong></p><ul><li><code>p_causal::Vector{Float64}</code>: Prior probabilities for variants to be causal</li><li><code>σ2_β::Vector{Float64}</code>: Prior variances for effect sizes (slab component)</li><li><code>coef::Vector{Float64}</code>: Effect sizes from GWAS summary statistics</li><li><code>SE::Vector{Float64}</code>: Standard errors of the effect sizes</li><li><code>R::Matrix{Float64}</code>: LD correlation matrix</li><li><code>XtX::Matrix{Float64}</code>: Matrix equal to N times the covariance matrix of genotypes</li><li><code>Xty::Vector{Float64}</code>: Vector of inner products between genotypes and phenotype</li><li><code>to::TimerOutput</code>: Timer output object for performance profiling</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>P::Int64=1_000</code>: Number of variants</li><li><code>n_elbo::Int64=10</code>: Number of Monte Carlo samples for ELBO estimation</li><li><code>max_iter::Int64=5</code>: Maximum number of iterations for convergence</li><li><code>N::Float64=10_000</code>: Sample size</li><li><code>yty::Float64=10_000</code>: Sum of squared phenotypes</li><li><code>spike_σ2::Float64=1e-6</code>: Variance for the spike component</li><li><code>update_σ2::Bool=true</code>: Whether to update the residual variance</li><li><code>σ2::Float64=1.0</code>: Initial residual variance</li></ul><p><strong>Returns</strong></p><p>A named tuple containing:</p><ul><li><code>q_μ::Vector{Float64}</code>: Posterior means for the slab component</li><li><code>q_spike_μ::Vector{Float64}</code>: Posterior means for the spike component</li><li><code>q_α::Vector{Float64}</code>: Posterior inclusion probabilities</li><li><code>q_var::Vector{Float64}</code>: Posterior variances for the slab component</li><li><code>q_odds::Vector{Float64}</code>: Posterior odds for variant inclusion</li><li><code>loss::Float64</code>: Final ELBO value</li><li><code>se_loss::Float64</code>: Standard error of the ELBO estimate</li><li><code>σ2::Float64</code>: Final residual variance estimate</li></ul><p><strong>Details</strong></p><p>This function implements an iterative Coordinate Ascent Variational Inference algorithm for a  spike-and-slab model, commonly used in Polygenic Risk Score (PRS) calculation. At each iteration, it updates the variational parameters to maximize the Evidence Lower Bound (ELBO).</p><p>The algorithm stops when insufficient improvement in ELBO is detected or when the maximum number of iterations is reached. The best parameters (with highest ELBO) are returned.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/train.jl#L1-L45">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.simulate_raw" href="#PRSFNN.simulate_raw"><code>PRSFNN.simulate_raw</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">simulate_raw(; N = 10_000, P = 1_000, K = 100, h2 = 0.10)</code></pre><p>Simulate genotype and phenotype data with genetic architecture influenced by functional annotations.</p><p><strong>Arguments</strong></p><ul><li><code>N::Int=10_000</code>: Number of samples/individuals</li><li><code>P::Int=1_000</code>: Number of genetic variants/SNPs</li><li><code>K::Int=100</code>: Number of functional annotations</li><li><code>h2::Float64=0.10</code>: Desired narrow-sense heritability of the trait</li></ul><p><strong>Returns</strong></p><p>A named tuple containing:</p><ul><li><code>X::Matrix{Float64}</code>: Genotype matrix (N × P)</li><li><code>β::Vector{Float64}</code>: True causal effect sizes</li><li><code>Y::Vector{Float64}</code>: Simulated phenotypes</li><li><code>Σ::Matrix{Float64}</code>: Covariance matrix of genotypes (LD structure)</li><li><code>s::Vector{Float64}</code>: Per-SNP normalized variance scalars derived from annotations</li><li><code>G::Matrix{Float64}</code>: Matrix of functional annotations (P × K)</li><li><code>γ::Vector{Int}</code>: Binary indicators of causal status (1=causal, 0=non-causal)</li><li><code>function_choices::Vector{Int}</code>: Selected functional forms for each annotation</li><li><code>phi::Vector{Function}</code>: Functions mapping each annotation to effect size variance</li><li><code>sigma_squared::Vector{Float64}</code>: Per-SNP variance components before normalization</li></ul><p><strong>Details</strong></p><p>This function simulates genotype and phenotype data with a realistic genetic architecture:</p><ol><li>Genotypes (X) are simulated with a realistic LD structure using random eigendecomposition</li><li>10% of variants are designated as causal (γ)</li><li>Functional annotations (G) influence effect size variance through different functional forms</li><li>Effect sizes follow a spike-and-slab distribution:<ul><li>Causal variants: Normal(0, scaled_variance)</li><li>Non-causal variants: Normal(0, tiny_variance)</li></ul></li><li>Phenotypes are computed as Y = Xβ + ε, with noise calibrated to achieve target heritability</li></ol><p>The simulation includes both continuous and binary annotations, with varying relationships to effect size variance (linear, quadratic, or null effects).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/simulate.jl#L42-L79">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.infer_σ2" href="#PRSFNN.infer_σ2"><code>PRSFNN.infer_σ2</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">`infer_σ2(coef, SE, R, D, X_sd, N, P)`

# Arguments
- `coef::Vector`: A length P vector of effect sizes
- `SE::Vector`: A length P vector of standard errors
- `XtX::AbstractArray`: A P x P matrix equal to N times the covariance matrix of the genotypes
- `Xty::Vector`: A length P vector of the inner product between genotype and phenotype
- `N`: Number of samples
- `P`: Number of SNPs</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/train.jl#L205-L215">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PRSFNN.poet_cov" href="#PRSFNN.poet_cov"><code>PRSFNN.poet_cov</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">poet_cov(X::AbstractArray; K = 100, τ = 0.01, N = 1000)</code></pre><p>Apply POET (Principal Orthogonal complEment Thresholding) method to estimate a sparse covariance matrix.</p><p><strong>Arguments</strong></p><ul><li><code>X::AbstractArray</code>: Input covariance or correlation matrix</li><li><code>K::Int=100</code>: Number of principal components to retain</li><li><code>τ::Float64=0.01</code>: Thresholding parameter for sparsity</li><li><code>N::Int=1000</code>: Sample size used for bias correction</li></ul><p><strong>Returns</strong></p><ul><li><code>Sigma::Matrix{Float64}</code>: The POET-estimated covariance matrix</li></ul><p><strong>Details</strong></p><p>Implements the POET method for high-dimensional covariance matrix estimation. The method decomposes the matrix into a low-rank component (representing systematic factors) and a sparse component (representing idiosyncratic noise). The sparse component is obtained by thresholding.</p><p>Reference: https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5563862/</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/weinstockj/PRS/blob/12fa245075ccdd91dd64283ffdce793568003d49/src/LD.jl#L97-L118">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Tuesday 10 June 2025 18:48">Tuesday 10 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
